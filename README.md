# 智能文档问答系统 (Intelligent Document Q&A System)

参考企业RAG比赛项目：https://github.com/trustbit/enterprise-rag-challenge/tree/main
打造了一个基于检索增强生成（RAG）技术的智能文档问答系统，支持多领域专业问答、多答案类型处理和文档管理功能。
在此基础上，可以进行进一步的二次开发，比如增加更多领域的专业支持，提升系统的实用性和价值。

## 📋 目录

- [项目简介](#项目简介)
- [主要功能](#主要功能)
- [技术架构](#技术架构)
- [快速开始](#快速开始)
- [使用指南](#使用指南)
- [领域支持](#领域支持)
- [答案类型](#答案类型)
- [系统配置](#系统配置)
- [项目结构](#项目结构)
- [核心模块](#核心模块)
- [常见问题](#常见问题)
- [更新日志](#更新日志)
- [贡献指南](#贡献指南)

## 🎯 项目简介

智能文档问答系统是一个基于RAG技术的专业问答平台，能够：

- **精准理解**：基于上传的文档内容进行问答，不引入外部知识
- **多领域适配**：针对不同领域提供专业的问答服务
- **结构化输出**：支持多种答案类型，输出结构化的分析结果
- **用户友好**：直观的Web界面，支持文档管理和历史记录

该系统适用于企业报告分析、学习资料问答、金融投资研究、技术文档查询等多种场景。

## ✨ 主要功能

### 📁 文档管理
- 支持PDF文件上传和批量处理
- 自动解析文档内容并建立检索索引
- 按领域隔离存储文档，确保数据安全
- 保留上传历史，支持返回查看

### 💬 智能问答
- 基于RAG技术的精准问答
- 多答案类型支持（文本、数字、布尔值、名称列表）
- 详细的分步推理过程
- 相关页面引用和来源标注
- 专业领域知识适配

### 🔧 系统特性
- **领域隔离**：不同领域的文档和处理逻辑完全隔离
- **状态管理**：智能管理用户会话状态，确保操作一致性
- **处理保护**：上传处理过程中禁止模式切换，避免错误
- **错误处理**：完善的错误捕获和提示机制
- **响应式设计**：适配不同设备屏幕

## 🏗️ 技术架构

### 核心技术栈
- **前端**：Streamlit
- **后端**：Python 3.9+
- **文档处理**：PDF解析、文本分割
- **检索系统**：FAISS向量数据库
- **生成模型**：LLM API（支持多种模型）
- **数据验证**：Pydantic

### 系统架构
┌────────────────────┐     ┌────────────────────┐     ┌────────────────────┐
│    Streamlit UI    │────>│     文档处理模块   │────>│   向量存储与检索    │
└────────────────────┘     └────────────────────┘     └────────────────────┘
↑                           ↑                           ↑
│                           │                           │
↓                           ↓                           ↓
┌────────────────────┐     ┌────────────────────┐     ┌────────────────────┐
│     会话状态管理     │<──│   RAG处理流程  │<────     │     LLM API调用    │
└────────────────────┘     └────────────────────┘     └────────────────────┘


### 处理流程

1. **文档上传**：用户上传PDF文件
2. **文档解析**：解析PDF内容，提取文本和结构
3. **文本分割**：将文档分割为合适大小的文本块
4. **向量嵌入**：将文本块转换为向量表示
5. **存储索引**：构建FAISS索引用于快速检索
6. **问题处理**：接收用户问题，分析问题类型和领域
7. **相关检索**：基于问题检索相关文档内容
8. **提示构建**：根据领域和问题类型构建专业提示词
9. **LLM生成**：调用LLM生成结构化回答
10. **结果展示**：展示分步推理和最终答案

## 🚀 快速开始

### 环境要求
- Python 3.9 或更高版本
- pip 包管理器
- 足够的磁盘空间用于存储上传的PDF和索引文件

### 安装步骤

1. **克隆项目**
   ```bash
   git clone https://github.com/yourusername/Intelligent-Document-Q%26A-System.git
   cd Intelligent-Document-Q%26A-System

2. **安装依赖**
   ```bash
    pip install -r requirements.txt

3. **配置环境变量**
- 在.env填写必要的API密钥和配置信息（OpenAI、IBM、Gemini、DashScope、Jina、OSS）
- 默认使用的DashScope Qwen模型
- 阿里云OSS配置
  - OSS_ACCESS_KEY_ID（.env）
  - OSS_ACCESS_KEY_SECRET（.env）
  - ALIYUN_OSS_ENDPOINT（src\pdf_mineru.py）
  - ALIYUN_OSS_BUCKET（src\pdf_mineru.py）

4. **启动应用**
   ```bash
    streamlit run app_streamlit.py

5. **访问系统**
- 打开浏览器，访问 `http://localhost:8501`
- 上传PDF文档并开始问答

## 📖 使用指南
### 基本操作
1. 选择模式 ：在顶部选择您需要的问答模式（通用问答、公司年报问答等）
2. 上传文档 ：在左侧边栏上传相关PDF文档
3. 点击处理 ：上传完成后点击"上传并处理"按钮
4. 等待处理 ：系统会自动解析文档并建立索引
5. 输入问题 ：在主界面输入您的问题
6. 选择答案类型 ：根据问题性质选择合适的答案类型
7. 提交提问 ：点击"提问"按钮获取回答
8. 查看结果 ：系统会展示详细的分析过程和最终答案
### 高级功能
- 切换领域 ：完成当前任务后，可以切换到其他领域
- 管理文档 ：可以查看已上传的文档，或清空所有文档
- 调整答案类型 ：根据问题需要选择不同的答案类型获取更精准的回答
- 查看处理状态 ：上传处理过程中系统会显示处理状态和进度

## 🎯 领域支持
系统支持以下专业领域：
领域                描述                      适用场景 
通用问答    适用于任意类型文档的问答      一般性文档查询、快速信息提取 
公司年报问答 专门处理公司财务报告、       年报等 财务分析、业绩评估、投资决策 
学习资料问答 针对教育相关文档的专业问答    教材学习、知识点查询、作业辅导 
股票投资问答 专注于股票市场和投资分析      投资研究、市场分析、股票评估 
汽车领域问答 处理汽车相关技术文档         汽车维修、技术参数查询、购车咨询 
医疗健康问答 专业医疗健康信息查询         医疗知识、疾病咨询、健康管理

## 📊 答案类型
系统支持以下答案类型：
类型       描述        输出格式                 适用场景
string  文本回答     详细文本分析            总结、解释、描述性问题
number  数字回答     精确数值 + 分析        数值查询、统计数据、财务指标
boolean 布尔回答     True/False + 分析      是/否问题、确认性问题
names   名称列表     结构化名称列表        人物、产品、技术、术语等名称提取

## ⚙️ 系统配置
### 主要配置项
- LLM API设置 ：在 .env 文件中配置API密钥和模型参数
- 向量存储配置 ：调整FAISS索引参数以优化检索性能
- 处理参数 ：配置文本分割大小、检索数量等参数
- 界面设置 ：调整Streamlit界面参数和样式
### 性能优化
- 内存管理 ：对于大型文档，建议适当调整文本分割大小
- 检索优化 ：根据文档类型调整检索参数以获得最佳结果
- API调用 ：合理设置LLM参数以平衡速度和质量

📁 项目结构
Intelligent-Document-Q&A-System/
├── app_streamlit.py         # Streamlit主应用
├── main.py                  # 命令行工具
├── src/                     # 核心功能模块
│   ├── pipeline.py          # 处理流程管理
│   ├── single_pdf_processor.py  # 单PDF处理
│   ├── api_requests.py      # API请求处理
│   ├── prompts.py           # 提示词定义
│   ├── ingestion.py         # 索引插入
│   ├── pdf_mineru.py        # PDF解析
│   ├── retrieval.py         # 检索功能
│   ├── reranking.py         # 重排序
│   ├── text_splitter.py     # 文本分割
│   ├── dynamic_retriever.py # 动态检索器
│   ├── questions_processing.py # 问题处理
├── data/                    # 数据存储(第一次运行之后创建)
│   ├── uploaded_pdfs/       # 用户上传的PDF
│   └── stock_data/          # 处理后的文档
│       ├── debug_data/      # 调试数据
│       ├── databases/       # 数据库存储
├── Test_data/               # 测试数据
├── requirements.txt         # 依赖声明
└── README.md                # 项目说明

## 🔍 核心模块
### 1. 文档处理模块
- 功能 ：解析PDF文档，提取文本内容
- 关键特性 ：支持复杂PDF格式，保留文档结构
- 处理流程 ：PDF解析 → 文本提取 → 结构分析
### 2. 检索模块
- 功能 ：基于用户问题检索相关文档内容
- 关键特性 ：向量相似度搜索，上下文相关排序
- 技术 ：FAISS向量数据库，语义相似度计算
### 3. RAG处理模块
- 功能 ：整合检索结果和LLM生成
- 关键特性 ：领域适配，答案类型处理
- 流程 ：检索结果 → 提示词构建 → LLM调用 → 结果处理
### 4. 会话管理模块
- 功能 ：管理用户会话状态
- 关键特性 ：领域隔离，状态一致性
- 管理对象 ：上传文件、处理状态、模块切换状态
## ❓ 常见问题
### 1. 上传文档失败
- 可能原因 ：文件太大、格式不支持、网络问题
- 解决方案 ：尝试较小的文件，确保是标准PDF格式，检查网络连接
### 2. 回答不准确
- 可能原因 ：文档内容不完整、问题表述不清、检索结果不相关
- 解决方案 ：上传更完整的文档，明确问题表述，尝试调整答案类型
### 3. 系统响应缓慢
- 可能原因 ：文档过大、服务器负载高、LLM响应慢
- 解决方案 ：分割大型文档，避开高峰期使用，调整系统参数
### 4. 模式切换失败
- 可能原因 ：处理过程中尝试切换、系统状态异常
- 解决方案 ：等待当前处理完成，或刷新页面重新开始

## 🤝 贡献指南
欢迎贡献代码、报告问题或提出建议！

1. 报告问题 ：在GitHub Issues中提交详细的问题描述
2. 贡献代码 ：Fork仓库，创建分支，提交Pull Request
3. 改进建议 ：通过Issues或邮件提出您的建议
## 📞 联系我们
如有任何问题或合作意向，请通过以下方式联系：

- 项目维护者 ：[维护者名称]
- 邮箱 ：[19861629721@163.com]
- GitHub ：[项目仓库链接]

智能文档问答系统 - 让知识获取更智能、更高效！
